<!DOCTYPE HTML>
<html lang="en" class="no-js">
  <head>
    <title>Brizi Dashboard</title>
    <meta name"viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="images_branding/favicon_16.ico">
    <!-- Le CSS -->
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./ilightbox/src/css/ilightbox.css"/>
    <!-- Ordering matters here in css files, voting.css over-rides the size of twitter buttons. -->
    <link rel="stylesheet" type="text/css" href="./voting.css">
    <link rel="stylesheet" type="text/css" href="./overlay/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="./overlay/css/demo.css" />
    <link rel="stylesheet" type="text/css" href="./overlay/css/style1.css" />
    <script src="./overlay/js/modernizr.custom.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-48566696-1', 'flybrizi.com', {'cookieDomain': 'none'});
      ga('send', 'pageview');

    </script>
  </head>

  <body>
    <div id="mainContainer" class="container">

      <div class="row">
        <div class="col-md-12" >
          <p align="center">
            <img align="middle" src="./images_branding/brizi_icon.png" class="img-responsive img-circle" alt="Responsive image" height="180" width="180" />
            <button id="trigger-overlay" type="button" class="btn btn-default btn-lg">
              <span class="glyphicon glyphicon-info-sign"></span>
            </button>
          </p>
        </div> <!-- col-md-12 -->
      </div>

      <div class="row customDiv">
        <div class="col-md-12" align="center">
          <h2 style="font-size:41px;"> -- Live photo gallery, click to view! -- </h2>
          <a id="image_gallery" href="#" target="_blank"><img class="img-responsive" style="width: auto;" src="../images_ftp/thumb0636.png"></a>
        </div>
      </div>

      <div class="row customDiv">
        <h2> -- Crowd-sourced Brizi's flight controls -- </h2>
        <h4>VOTE NOW: Where should Brizi Cam fly to next?!</h4>
        <h4><span id="countdown" style="color:red;"></span></h4>
        <div class="col-md-6">
          <form
            method="POST"
            action="voting.php" 
            target="iFrameTarget"
            enctype="multipart/form-data"
            id="poll">
            <div>
              <div class="input-group">
                <span class="input-group-addon" style="background-color: rgb(95,189,222);">
                  <input type="radio" name="location" value="Exhibit Booths"> 
                    <font size="5" color="white">Exhibit Booths</font>
                </span>
              </div><!-- /input-group -->
              <div class="input-group">
                <span class="input-group-addon" style="background-color: rgb(239,172,79);">
                  <input type="radio" name="location" value="Speaker Stage"> 
                    <font size="5" color="white">Speaker Stage</font>
                </span>
              </div><!-- /input-group -->
              <div class="input-group">
                <span class="input-group-addon" style="background-color: rgb(214,84,84);">
                  <input type="radio" name="location" value="Workshop Section"> 
                    <font size="5" color="white">Workshop Section</font>
                </span>
              </div><!-- /input-group -->
              <div class="input-group">
                <span class="input-group-addon" style="background-color: rgb(97,186,94);">
                  <input type="radio" name="location" value="Above Sami"> 
                    <font size="5" color="white">Over Sami's Head</font>
                </span>
              </div><!-- /input-group -->
            <input type="submit"
                   class="btn btn-default"
                   id="submitButton"
                   name="submitButton"
                   value="Cast Vote!"
                   style="font-family:arial;color:red;font-size:25px;width:100%;"
                   disabled />
            </div><!-- /.col-md-6 -->
          </form>
        </div> <!-- col-md-6 -->
        <div class="col-md-6">
          <div class="voteResultsTable" id="voteResultsTable">
            <div class="progress progress-striped" style="height:30px; margin-top:6px; margin-bottom:11px;">
              <font size="5" style="vertical-align:top;">Exhibit Booths</font>
              <div class="progress-bar progress-bar-info myProgressBars" id="progressBarDiv2" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                <span id="progressBarSpan2"><font size="5"/></span>
              </div>
            </div> <!-- class="progress progress-striped" -->
            <div class="progress progress-striped" style="height:30px; margin-top:6px; margin-bottom:11px;">
              <font size="5" style="vertical-align:top;">Speaker Stage</font>
              <div class="progress-bar progress-bar-warning myProgressBars" id="progressBarDiv3" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                <span id="progressBarSpan3"><font size="5"/></span>
              </div>
            </div> <!-- class="progress progress-striped" -->
            <div class="progress progress-striped" style="height:30px; margin-top:6px; margin-bottom:11px;">
              <font size="5" style="vertical-align:top;">Workshop Section</font>
              <div class="progress-bar progress-bar-danger myProgressBars" id="progressBarDiv4" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                <span id="progressBarSpan4"><font size="5"/></span>
              </div>
            </div> <!-- class="progress progress-striped" -->
            <div class="progress progress-striped" style="height:30px; margin-top:6px; margin-bottom:11px;">
              <font size="5" style="vertical-align:top;">Over Sami's Head</font>
              <div class="progress-bar progress-bar-success myProgressBars" id="progressBarDiv1" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 25%;">
                <span id="progressBarSpan1"><font size="5"/></span>
              </div>
            </div> <!-- class="progress progress-striped" -->
          </div> <!-- voteResultsTable" -->
        </div> <!-- col-md-6 -->
      </div>

      <div class="row customDiv">
        <div class="col-md-6" align="right">
          <!-- Live Stream -->
          <div
            id="livestream"
            style="position:relative"
            align="center">
            <h2 style="font-size:41px;"> -- Live-stream from Brizi -- </h2>
            <iframe
              style="border: 0 none transparent;"
              src="//www.ustream.tv/embed/17420200?wmode=direct"
              height="370"
              width="100%"
              frameborder="no"></iframe>
          </div>
        </div> <!-- col-md-6 -->

        <div class="col-md-6" align="left">
          <h2 style="font-size:41px;"> -- Checkout the buzz! -- </h2>
          <!-- Twitter Widget -->
          <div align="center">
            <style type="text/css">
              #twitter-widget-0{width:840px;}
            </style>
            <a
              class="twitter-timeline"
              href="https://twitter.com/search?q=%23besteventever"
              data-widget-id="443893199812050944">
              Tweets about "#BestEventEver"
            </a>
          </div>
        </div> <!-- col-md-6 -->
      </div>

      <div class="overlay overlay-hugeinc">
        <button type="button" class="overlay-close">Close</button>

        <nav>
          <ul>
            <p>Hello, meet Brizi!</p>
            <li>Flying <i>above it all</i> at NBTC</li>
            <li>Brizi is capturing images of you and your friends as we speak!! See what Brizi sees in our image gallery, and hear what people are saying!</li>
            <br>
            <br>
            <li class="closeText"><a href="#">Close</a></li>
          </ul>
        </nav>
      </div>

    </div> <!-- container -->

    <!-- Le Javascript -->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/jquery-1.11.0.min.js"></script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    
    <script src="./ilightbox/assets/js/jquery.js"></script>
    <script src="./ilightbox/assets/js/jquery.requestAnimationFrame.js"></script>
    <script src="./ilightbox/src/js/jquery.mousewheel.js"></script>
    <script src="./ilightbox/src/js/ilightbox.js"></script>
    <script src="./overlay/js/classie.js"></script>
    <script src="./overlay/js/demo1.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){

        /* CONSTANTS
        -------------------------------------------------- */
        var EVENT_NAME = 'event';
        var TABLE_NAME = 'voting_' + EVENT_NAME;
        var ONE_SEC_IN_MS = 1000;
        var TABLE_REFRESH_TIME_IN_MS = 5000;
        var IMAGE_DIRECTORY = "../images_ftp";
        var GALLERY_REFRESH_TIME_IN_MS = 3500;
        var images_in_gallery = new Array();
        var max_image_width = 5000; // very large
        var max_image_height = 5000; // very large

        var MAX_MOBILE_SCREEN_WIDTH = 480;
        if( screen.width <= MAX_MOBILE_SCREEN_WIDTH ) {
          $('#livestream').hide();
          max_image_width = 980;
          max_image_height = 980;
        }

        /* INITIAL LOAD
        -------------------------------------------------- */
        // Gallery
        $.ajax({
          url: '../gallery.php',
          type: 'POST',
          dataType: 'json',
          data: {
            func: 'returnImages',
            directory: './images_ftp/',
          },
          success: function(response) {
            console.log(response);
            images_in_gallery = new Array();
            response.forEach(function(image_name) {
              images_in_gallery.push({
                "URL": IMAGE_DIRECTORY + '/' + image_name,
                type: "image",
                options: {
                  width: max_image_width,
                  height: max_image_height,
                },
              });
            });
          },
          error: function (request, status, error) {
            console.log(request.responseText);
          }
        });

        // Poll
        $.ajax({
          url: '../voting.php',
          type: 'POST',
          dataType: 'json',
          data: {
            func: 'checkVoteResults',
            table: TABLE_NAME
          },
          success: function(response) {
            console.log(response);
            renderProgressBars(response);
          },
          error: function (request, status, error) {
            console.log(request.responseText);
          }
        });


        /* IMAGE GALLERY RELATED
        -------------------------------------------------- */
        var socialButtons = {
          facebook: true,
          twitter: true,
        };

        $('#image_gallery').click(function(){
          $.iLightBox(
            images_in_gallery,
            {
              // Available skins are: dark, light, parade, smooth, metro-black, metro-white and mac.
              skin: 'mac',
              path: 'horizontal',
              mobileOptimizer: true,
              innerToolbar: true,
              social: {
                start: true,
                buttons: socialButtons
              },
              overlay: {
                opacity: .85
              },            
              fullAlone: 0,
              controls: {
                thumbnail: 1,
                arrows: 1,
                slideshow: 1,
                toolbar: false
              },
              slideshow: {
                startPaused: false,
                pauseTime: 4000,
                pauseOnHover: true
              },
              thumbnails: {
                normalOpacity: .3,
                activeOpacity: 1
              },
              styles: {
                pageOffsetY: 100,
                nextScale: 0.6,
                prevScale: 0.6,
                nextOpacity: 0.6,
                prevOpacity: 0.6
              },
            }
          );
          return false;
        });

        $('#poll').submit(function(event) {
          var submitButton = !$("#submitButton").prop('disabled');
          var location = $('#poll input:radio:checked').val()
          event.preventDefault();
          // Disable form (submitButton and radio buttons) after vote casted
          $("#submitButton").prop('disabled',true);
          $('#poll input:radio').prop('disabled',true);
          $.ajax({
            url: '../voting.php',
            type: 'POST',
            dataType: 'json',
            data: {
              location: location,
              func: 'caseVote',
              table: TABLE_NAME
            },
            success: function(response) {
              console.log(response);
              renderProgressBars(response);
            },
            error: function (request, status, error) {
              console.log(request.responseText);
            }
          });
        });


        /* POLLS RELATED
        -------------------------------------------------- */   
        // Enable submitButton only after a radio button has been clicked
        $("input[type=radio]").click(function() { 
          $("#submitButton").prop('disabled',false);
        });

        function renderProgressBars(vote_count_object){

          var total_vote_count = 0;
          for (var vote_category in vote_count_object){
            total_vote_count += parseInt(vote_count_object[vote_category]);
          }

          vote_result_percentages = new Array();
          var progressBarIndex = 1;
          for (var vote_category in vote_count_object){
            if (total_vote_count == 0){
              vote_result_percentages[vote_category] = 0;
            }
            else {
              vote_result_percentages[vote_category] =
              Math.floor((vote_count_object[vote_category] / total_vote_count) * 100);
            }

            document.getElementById("progressBarSpan" + progressBarIndex).innerHTML =
              vote_result_percentages[vote_category] + "%";

            // $('#progressBar' + progressBarIndex).animate({width:'80%'});
            $('#progressBarDiv' + progressBarIndex).width(vote_result_percentages[vote_category] + "%");
            progressBarIndex += 1;
          }
        }

        // set the date we're counting down to
        var target_date = new Date("March 25, 2014 14:15:00").getTime();
        if (target_date > new Date()) {
          // variables for time units
          var days, hours, minutes, seconds;
          // get tag element
          var countdown = document.getElementById("countdown");
          // update the tag with id "countdown" every 1 second
          setInterval(function () {
              // find the amount of "seconds" between now and target
              var current_date = new Date().getTime();
              var seconds_left = (target_date - current_date) / 1000;
              // do some time calculations
              days = parseInt(seconds_left / 86400);
              seconds_left = seconds_left % 86400;
              hours = parseInt(seconds_left / 3600);
              seconds_left = seconds_left % 3600;
              minutes = parseInt(seconds_left / 60);
              seconds = parseInt(seconds_left % 60);
              // format countdown string + set tag value
              countdown.innerHTML = "[countdown " + hours + "h, "
              + minutes + "m, " + seconds + "s" + "]";
          }, ONE_SEC_IN_MS);
        }
        else {
          var countdown = document.getElementById("countdown");
          countdown.innerHTML = "Poll is now closed. Come back soon for a new Brizi poll!";
          $('#poll input:radio').prop('disabled',true);
        }

        /* PERIODIC REFRESH OF GALLERY, AND POLL RESULTS
        -------------------------------------------------- */
        setInterval(function () {
          $.ajax({
            url: '../gallery.php',
            type: 'POST',
            dataType: 'json',
            data: {
              func: 'returnImages',
              directory: './images_ftp/',
            },
            success: function(response) {
              console.log(response);
              images_in_gallery = new Array();
              response.forEach(function(image_name) {
                debugger
                images_in_gallery.push({
                  "URL": IMAGE_DIRECTORY + '/' + image_name,
                  type: "image",
                  options: {
                    width: max_image_width,
                    height: max_image_height,
                  },
                });
              });              
            },
            error: function (request, status, error) {
              console.log(request.responseText);
            }
          });
        }, GALLERY_REFRESH_TIME_IN_MS);
        setInterval(function () {
          $.ajax({
            url: '../voting.php',
            type: 'POST',
            dataType: 'json',
            data: {
              func: 'checkVoteResults',
              table: TABLE_NAME
            },
            success: function(response) {
              console.log(response);
              renderProgressBars(response);
            },
            error: function (request, status, error) {
              console.log(request.responseText);
            }
          });
        }, TABLE_REFRESH_TIME_IN_MS);
      });
      </script>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
    </script>
  </body>
</html>
